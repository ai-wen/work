# AES与SM4实现原理的比较
## 基本比较
三种算法的基本比较如下表：
算法名称	密钥长度	    分组长度	    循环次数	算法结构
AES	        128/192/256	    128	        10/12/14	Substitution-Permutation
SM4	        128	            128	        32	        非平衡Feistel

## 每轮操作的比较
在安全性设计方面，AES每轮的操作包括（1）使用S盒完成分组的字节到字节的代替（2）简单的行移位（3）列混淆（4）密钥轮加（异或）。
而SM4每轮的操作包括（1）将32位明文组与轮密钥异或（2）基于S盒的字节到字节的代替（3）基于移位的线性变换。

可以看到，两个算法的安全性均是基于S盒的非线性性以及线性变换提供的扩散作用。密钥的使用方式也均是将密钥与明文或加密结果异或。一点小区别在于，AES算法在每轮的最后使用密钥，而SM4算法在每轮的开始使用密钥。

## 密钥调度算法的比较
SM4的密钥调度算法和加密算法基本相同，同样是将密钥分为32位的4组，然后通过S盒代替、线性变换来产生各轮密钥。
与此形成对照，AES算法的密钥产生则较为繁琐，主要是区分了Nk<6, Nk>=6, 以及i-4或i是Nk的整数倍这些情况。不过其中同样也是用了S盒和线性变换。

## 具体的编码细节
在加密过程上，两个算法都使用了状态变量存储加密结果，如AES主要是操作state数组来完成加密，而SM4则是通过对ulbuf变量的操作完成了加密过程。

两个算法都精心地设计了位操作，使得不必把每个加密的block展开为每个比特为1个个变量，而是单纯地使用long int或者unsigned char这样类型的变量就可以完成加密。

## 小结
通过以上分析可以看到，SM4算法实现起来较为简单，密钥调度和加密的算法基本相同，而且解密时也可以使用同样的程序，只要将密钥的顺序倒置即可。
而AES算法则使用了复杂的密钥调度算法，并且解密算法也需要另外编写代码，实现起来更复杂一些。
